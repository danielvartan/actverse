% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/actogram.R
\name{actogram}
\alias{actogram}
\title{Create an actogram plot from actigraphy data}
\usage{
actogram(
  data,
  col = "pim",
  days = 7,
  transform = identity,
  state_col = "state",
  state_alpha = 0.5,
  latitude = NULL,
  longitude = NULL,
  sun_stats_method = "suncalc",
  labels = NULL,
  colors = NULL,
  grid = TRUE,
  minor_breaks = ggplot2::waiver(),
  date_format = "\%a \%d/\%m",
  locale = get_en_locale(),
  double_plot = TRUE,
  x_label = NULL,
  y_label = NULL,
  print = TRUE,
  ...
)
}
\arguments{
\item{data}{A \code{\link[tsibble:tsibble]{tsibble}} object.}

\item{col}{(optional) A string indicating which column of \code{data} to use for
the area plot (default: \code{"pim"}).}

\item{days}{(optional) A number specifying how many days to display in the
actogram. Use a negative value to exclude days from the end of the record.
Set to \code{Inf} to plot all available days (default: \code{7}).}

\item{transform}{(optional) A transformation function to apply to
\code{col} (default: \code{\link[base:identity]{identity}}).}

\item{state_col}{(optional) A string indicating which column of \code{data} have
the states/categories data (default: \code{NULL}).}

\item{state_alpha}{(optional) A number, from \code{0} to \code{1}, indicating the
transparency level of the state rectangles (default: \code{0.5}).}

\item{latitude}{(optional) A number indicating the latitude in decimal
degrees that must be used to compute the light/dark phase. Set this
argument to \code{NULL} when the light/dark is not needed. See the Details
section to learn more (default: \code{NULL}).}

\item{longitude}{(optional) A number indicating the longitude in decimal
degrees that must be used to compute the light/dark phase. Set this
argument to \code{NULL} when the light/dark is not needed. See the Details
section to learn more (default: \code{NULL}).}

\item{sun_stats_method}{(optional) A string indicating the method to use for
computing the light/dark phase. See \code{\link[=get_sun_stats]{get_sun_stats()}}
for more details (default: \code{"suncalc"}).}

\item{labels}{(optional) A named character vector to rename states in the
legend. Must include labels for any used state values, and \code{"base"} (label
for \code{col}), \code{"lp"} (light phase), and \code{"dp"} (dark phase) if applicable.
See the Details section to learn more.}

\item{colors}{(optional) A named character vector of colors to use for each
label/state. Must include named colors for any states used in \code{labels}, as
well as for \code{"base"} (color for \code{col}), \code{"lp"} (light phase), and \code{"dp"}
(dark phase). See the Details section to learn more.}

\item{grid}{(optional) A \code{\link[=logical]{logical}} flag indicating if the plot
must have an overlay grid (default: \code{TRUE}).}

\item{minor_breaks}{(optional) A \code{\link[base:numeric]{numeric}} vector
indicating the minor breaks on the x-axis
(default: \code{\link[ggplot2:waiver]{waiver()}}).}

\item{date_format}{(optional) Format string passed to
\code{\link[base:format]{format()}} for rendering date axis labels
(default: \code{"\%a \%d/\%m"}).}

\item{locale}{(optional) A string indicating the locale the
\href{https://en.wikipedia.org/wiki/Locale_(computer_software)}{\code{LC_TIME}}
environment variable must be set to. This is used to determine the language
of the date labels (default: \code{en_US.UTF-8}).}

\item{double_plot}{(optional) A \code{\link[base:logical]{logical}} flag indicating
whether to stack 24-hour periods in a double-plot layout
(default: \code{FALSE}).}

\item{x_label}{(optional) A string indicating the x-axis label
(default: \code{NULL}).}

\item{y_label}{(optional) A string indicating the y-axis label
(default: \code{NULL}).}

\item{print}{(optional) A \code{\link[=logical]{logical}} flag indicating if the
function must print the plot (default: \code{TRUE}).}

\item{...}{(optional) Additional arguments passed to
\code{\link[ggplot2:theme]{theme()}}.}
}
\value{
A \code{\link[ggplot2:ggplot]{ggplot}} object with the actogram plot.
}
\description{
\code{actogram()} creates an \href{https://en.wikipedia.org/wiki/Actogram}{actogram}
plot from a \code{\link[tsibble:tsibble]{tsibble}} time series object, visualizing
activity patterns across multiple days.
}
\details{
\subsection{Vertical lines in the plot}{

In some cases, you may notice thin vertical lines in the actogram
visualization. This is a rendering artifact that can depend on your graphic
device, graphics card, screen resolution, or the plot's size.

If you encounter this, try resizing the plot window (for example, making it
more square or adjusting its dimensions), which often resolves the problem.
We also strongly recommend using the \href{https://ragg.r-lib.org/}{\code{ragg}}
package for rendering graphics, as it can help avoid these artifacts.
}

\subsection{Light/Dark phase}{

The light/dark phase is determined using the first timestamp of the time
series. The time zone is inferred from this timestamp as well. If the time
zone does not correspond to the provided latitude and longitude, the
calculated light/dark phases may be misaligned.
}

\subsection{\code{transform} argument}{

\code{actogram()} allows you to provide a function for transforming the base
data. This is useful when dealing with extreme ranges.

Example:

\if{html}{\out{<div class="sourceCode r">}}\preformatted{library(magrittr)

trans_fun <- function(x) \{
  log(x) |>
  inset(log(x) < 1, 1) |>
  subtract(1)
\}

acttrust |>
  actogram(
    col = "light",
    days = 1,
    transform = trans_fun,
    double_plot = FALSE
  )
}\if{html}{\out{</div>}}

\figure{roxygen2-actogram-1.png}
}

\subsection{\code{labels} argument}{

The \code{labels} arguments allow you to customize the labels of the states in the
actogram. It must be a named character vector, where the names are the state
values and the values are the labels to be used in the legend. The order of
the labels will be the same as the order of the \code{labels} argument.

Example (default setting):

\if{html}{\out{<div class="sourceCode r">}}\preformatted{labels <- c(
  "1" = "Sleeping",
  "2" = "Resting",
  "4" = "Offwrist",
  "base" = "PIM",
  "lp" = "Light phase",
  "dp" = "Dark phase"
)
}\if{html}{\out{</div>}}
}

\subsection{\code{colors} argument}{

The \code{colors} arguments allow you to customize the colors of the states in
the actogram. Like the \code{label} argument, it must be a named character vector,
where the names are the state values and the values are the colors to be
used in the legend. The names of the \code{colors} must match the names of the
\code{labels}.

The colors follow the conventions used in \code{\link[ggplot2:ggplot]{ggplot2}}.
You can specify either standard color names or
\href{https://en.wikipedia.org/wiki/Web_colors}{hexadecimal color codes}.
Click
\href{https://ggplot2.tidyverse.org/reference/aes_colour_fill_alpha.html}{here}
to see the \code{ggplot2} color reference.

Example (default setting):

\if{html}{\out{<div class="sourceCode r">}}\preformatted{colors = c(
  "1" = "#410085",
  "2" = "#FFB426",
  "4" = "#FC2913",
  "base" = "#000040",
  "lp" = "#FFFFFF",
  "dp" = "#DBD7D3"
)
}\if{html}{\out{</div>}}
}
}
\examples{
library(curl)

if (has_internet()) {
  file <- get_from_zenodo(
    doi = "10.5281/zenodo.4898822",
    dir = tempdir(),
    file = "processed.txt"
  )

  data <- read_acttrust(file, tz = "America/Sao_Paulo")

  data |>
    actogram(
      col = "pim",
      days = 7,
      # github.com/danielvartan/orbis
      # orbis::get_brazil_state_latitude("sp")
      latitude = -23.55065,
      # orbis::get_brazil_state_longitude("sp"),
      longitude = -46.63338,
      double_plot = TRUE
    )
}
}
\concept{data visualization functions}
